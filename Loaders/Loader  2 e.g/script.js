let preload = {
  "assets": [{
    "id": "comp_0",
    "layers": [{
      "ddd": 0,
      "ind": 0,
      "ty": 4,
      "nm": "dropping_mask",
      "td": 1,
      "ks": {
        "o": {
          "k": 100 },

        "r": {
          "k": 0 },

        "p": {
          "k": [{
            "i": {
              "x": 0.667,
              "y": 1 },

            "o": {
              "x": 0.333,
              "y": 0 },

            "n": "0p667_1_0p333_0",
            "t": -14.985,
            "s": [200, 200, 0],
            "e": [200, 300, 0],
            "to": [0, 16.6666660308838, 0],
            "ti": [0, -13.3333330154419, 0] },
          {
            "i": {
              "x": 0.667,
              "y": 1 },

            "o": {
              "x": 0.333,
              "y": 0 },

            "n": "0p667_1_0p333_0",
            "t": 5.015,
            "s": [200, 300, 0],
            "e": [200, 280, 0],
            "to": [0, 13.3333330154419, 0],
            "ti": [0, 3.33333325386047, 0] },
          {
            "i": {
              "x": 0.667,
              "y": 0.667 },

            "o": {
              "x": 0.167,
              "y": 0.167 },

            "n": "0p667_0p667_0p167_0p167",
            "t": 15.015,
            "s": [200, 280, 0],
            "e": [200, 280, 0],
            "to": [0, 0, 0],
            "ti": [0, 0, 0] },
          {
            "i": {
              "x": 0.667,
              "y": 1 },

            "o": {
              "x": 0.167,
              "y": 0 },

            "n": "0p667_1_0p167_0",
            "t": 50.015,
            "s": [200, 280, 0],
            "e": [200, 380, 0],
            "to": [0, 16.6666660308838, 0],
            "ti": [0, -16.6666660308838, 0] },
          {
            "t": 65.0150006949902 }] },


        "a": {
          "k": [0, 0, 0] },

        "s": {
          "k": [100, 100, 100] } },


      "shapes": [{
        "ty": "gr",
        "it": [{
          "ty": "rc",
          "d": 1,
          "s": {
            "k": [{
              "i": {
                "x": [0.667, 0.667],
                "y": [1, 1] },

              "o": {
                "x": [0.333, 0.333],
                "y": [0, 0] },

              "n": ["0p667_1_0p333_0", "0p667_1_0p333_0"],
              "t": 75.015,
              "s": [0, 0],
              "e": [45, 45] },
            {
              "t": 89.9100036621094 }] },


          "p": {
            "k": [0, 0] },

          "r": {
            "k": 0 },

          "nm": "Rectangle Path 1" },
        {
          "ty": "st",
          "fillEnabled": true,
          "c": {
            "k": [1, 1, 1, 1] },

          "o": {
            "k": 100 },

          "w": {
            "k": 0 },

          "lc": 1,
          "lj": 1,
          "ml": 4,
          "nm": "Stroke 1" },
        {
          "ty": "fl",
          "fillEnabled": true,
          "c": {
            "k": [1, 1, 1, 1] },

          "o": {
            "k": 100 },

          "nm": "Fill 1" },
        {
          "ty": "tr",
          "p": {
            "k": [0, -180],
            "ix": 2 },

          "a": {
            "k": [0, 0],
            "ix": 1 },

          "s": {
            "k": [100, 100],
            "ix": 3 },

          "r": {
            "k": 45,
            "ix": 6 },

          "o": {
            "k": 100,
            "ix": 7 },

          "sk": {
            "k": 0,
            "ix": 4 },

          "sa": {
            "k": 0,
            "ix": 5 },

          "nm": "Transform" }],

        "nm": "Rectangle 1" }],

      "ip": 0,
      "op": 95.0000038694293,
      "st": 0,
      "bm": 0,
      "sr": 1 },
    {
      "ddd": 0,
      "ind": 1,
      "ty": 4,
      "nm": "dropping romb",
      "tt": 2,
      "ks": {
        "o": {
          "k": 100 },

        "r": {
          "k": 0 },

        "p": {
          "k": [{
            "i": {
              "x": 0.667,
              "y": 1 },

            "o": {
              "x": 0.333,
              "y": 0 },

            "n": "0p667_1_0p333_0",
            "t": -0.02,
            "s": [200, 200, 0],
            "e": [200, 300, 0],
            "to": [0, 16.6666660308838, 0],
            "ti": [0, -13.3333330154419, 0] },
          {
            "i": {
              "x": 0.667,
              "y": 1 },

            "o": {
              "x": 0.333,
              "y": 0 },

            "n": "0p667_1_0p333_0",
            "t": 16.219,
            "s": [200, 300, 0],
            "e": [200, 280, 0],
            "to": [0, 13.3333330154419, 0],
            "ti": [0, 3.33333325386047, 0] },
          {
            "i": {
              "x": 0.667,
              "y": 0.667 },

            "o": {
              "x": 0.167,
              "y": 0.167 },

            "n": "0p667_0p667_0p167_0p167",
            "t": 24.338,
            "s": [200, 280, 0],
            "e": [200, 280, 0],
            "to": [0, 0, 0],
            "ti": [0, 0, 0] },
          {
            "i": {
              "x": 0.667,
              "y": 1 },

            "o": {
              "x": 0.167,
              "y": 0 },

            "n": "0p667_1_0p167_0",
            "t": 52.756,
            "s": [200, 280, 0],
            "e": [200, 380, 0],
            "to": [0, 16.6666660308838, 0],
            "ti": [0, -16.6666660308838, 0] },
          {
            "t": 64.9350026448568 }] },


        "a": {
          "k": [0, 0, 0] },

        "s": {
          "k": [100, 100, 100] } },


      "shapes": [{
        "ty": "gr",
        "it": [{
          "ty": "rc",
          "d": 1,
          "s": {
            "k": [{
              "i": {
                "x": [0.667, 0.667],
                "y": [1, 1] },

              "o": {
                "x": [0.333, 0.333],
                "y": [0, 0] },

              "n": ["0p667_1_0p333_0", "0p667_1_0p333_0"],
              "t": 15.015,
              "s": [25, 25],
              "e": [12, 12] },
            {
              "i": {
                "x": [0.667, 0.667],
                "y": [0.667, 0.667] },

              "o": {
                "x": [0.333, 0.333],
                "y": [0.333, 0.333] },

              "n": ["0p667_0p667_0p333_0p333", "0p667_0p667_0p333_0p333"],
              "t": 45.015,
              "s": [12, 12],
              "e": [12, 12] },
            {
              "i": {
                "x": [0.667, 0.667],
                "y": [1, 1] },

              "o": {
                "x": [0.333, 0.333],
                "y": [0, 0] },

              "n": ["0p667_1_0p333_0", "0p667_1_0p333_0"],
              "t": 65.015,
              "s": [12, 12],
              "e": [50, 50] },
            {
              "t": 74.0147813349962 }] },


          "p": {
            "k": [0, 0] },

          "r": {
            "k": 0 },

          "nm": "Rectangle Path 1" },
        {
          "ty": "st",
          "fillEnabled": true,
          "c": {
            "k": [1, 1, 1, 1] },

          "o": {
            "k": 100 },

          "w": {
            "k": 0 },

          "lc": 1,
          "lj": 1,
          "ml": 4,
          "nm": "Stroke 1" },
        {
          "ty": "fl",
          "fillEnabled": true,
          "c": {
            "k": [1, 1, 1, 1] },

          "o": {
            "k": 100 },

          "nm": "Fill 1" },
        {
          "ty": "tr",
          "p": {
            "k": [0, -180],
            "ix": 2 },

          "a": {
            "k": [0, 0],
            "ix": 1 },

          "s": {
            "k": [100, 100],
            "ix": 3 },

          "r": {
            "k": 45,
            "ix": 6 },

          "o": {
            "k": 100,
            "ix": 7 },

          "sk": {
            "k": 0,
            "ix": 4 },

          "sa": {
            "k": 0,
            "ix": 5 },

          "nm": "Transform" }],

        "nm": "Rectangle 1" }],

      "ip": 0,
      "op": 95.0000038694293,
      "st": 0,
      "bm": 0,
      "sr": 1 },
    {
      "ddd": 0,
      "ind": 2,
      "ty": 4,
      "nm": "central_mask",
      "td": 1,
      "ks": {
        "o": {
          "k": 100 },

        "r": {
          "k": 0 },

        "p": {
          "k": [200, 200, 0] },

        "a": {
          "k": [0, 0, 0] },

        "s": {
          "k": [{
            "i": {
              "x": [0.833, 0.833, 0.833],
              "y": [0.833, 0.833, 0.833] },

            "o": {
              "x": [0.167, 0.167, 0.167],
              "y": [0.167, 0.167, 0.167] },

            "n": ["0p833_0p833_0p167_0p167", "0p833_0p833_0p167_0p167", "0p833_0p833_0p167_0p167"],
            "t": -14.985,
            "s": [0, 0, 100],
            "e": [0, 0, 100] },
          {
            "i": {
              "x": [0.833, 0.833, 0.833],
              "y": [1, 1, 0.833] },

            "o": {
              "x": [0.167, 0.167, 0.167],
              "y": [0, 0, 0.167] },

            "n": ["0p833_1_0p167_0", "0p833_1_0p167_0", "0p833_0p833_0p167_0p167"],
            "t": 51.948,
            "s": [0, 0, 100],
            "e": [100, 100, 100] },
          {
            "t": 74.0147813349962 }] } },



      "shapes": [{
        "ty": "gr",
        "it": [{
          "ty": "rc",
          "d": 1,
          "s": {
            "k": [50, 50] },

          "p": {
            "k": [0, 0] },

          "r": {
            "k": 0 },

          "nm": "Rectangle Path 1" },
        {
          "ty": "st",
          "fillEnabled": true,
          "c": {
            "k": [1, 1, 1, 1] },

          "o": {
            "k": 100 },

          "w": {
            "k": 0 },

          "lc": 1,
          "lj": 1,
          "ml": 4,
          "nm": "Stroke 1" },
        {
          "ty": "fl",
          "fillEnabled": true,
          "c": {
            "k": [1, 1, 1, 1] },

          "o": {
            "k": 100 },

          "nm": "Fill 1" },
        {
          "ty": "tr",
          "p": {
            "k": [0, 0],
            "ix": 2 },

          "a": {
            "k": [0, 0],
            "ix": 1 },

          "s": {
            "k": [100, 100],
            "ix": 3 },

          "r": {
            "k": 45,
            "ix": 6 },

          "o": {
            "k": 100,
            "ix": 7 },

          "sk": {
            "k": 0,
            "ix": 4 },

          "sa": {
            "k": 0,
            "ix": 5 },

          "nm": "Transform" }],

        "nm": "Rectangle 1" }],

      "ip": 0,
      "op": 90.0000036657751,
      "st": 0,
      "bm": 0,
      "sr": 1 },
    {
      "ddd": 0,
      "ind": 3,
      "ty": 4,
      "nm": "central romb",
      "tt": 2,
      "ks": {
        "o": {
          "k": 100 },

        "r": {
          "k": 0 },

        "p": {
          "k": [200, 200, 0] },

        "a": {
          "k": [0, 0, 0] },

        "s": {
          "k": [{
            "i": {
              "x": [0.667, 0.667, 0.667],
              "y": [1, 1, 0.667] },

            "o": {
              "x": [0.333, 0.333, 0.333],
              "y": [0, 0, 0.333] },

            "n": ["0p667_1_0p333_0", "0p667_1_0p333_0", "0p667_0p667_0p333_0p333"],
            "t": 21,
            "s": [0, 0, 100],
            "e": [100, 100, 100] },
          {
            "t": 30.0002443859975 }] } },



      "shapes": [{
        "ty": "gr",
        "it": [{
          "ty": "rc",
          "d": 1,
          "s": {
            "k": [50, 50] },

          "p": {
            "k": [0, 0] },

          "r": {
            "k": 0 },

          "nm": "Rectangle Path 1" },
        {
          "ty": "st",
          "fillEnabled": true,
          "c": {
            "k": [1, 1, 1, 1] },

          "o": {
            "k": 100 },

          "w": {
            "k": 0 },

          "lc": 1,
          "lj": 1,
          "ml": 4,
          "nm": "Stroke 1" },
        {
          "ty": "fl",
          "fillEnabled": true,
          "c": {
            "k": [1, 1, 1, 1] },

          "o": {
            "k": 100 },

          "nm": "Fill 1" },
        {
          "ty": "tr",
          "p": {
            "k": [0, 0],
            "ix": 2 },

          "a": {
            "k": [0, 0],
            "ix": 1 },

          "s": {
            "k": [100, 100],
            "ix": 3 },

          "r": {
            "k": 45,
            "ix": 6 },

          "o": {
            "k": 100,
            "ix": 7 },

          "sk": {
            "k": 0,
            "ix": 4 },

          "sa": {
            "k": 0,
            "ix": 5 },

          "nm": "Transform" }],

        "nm": "Rectangle 1" }],

      "ip": 0,
      "op": 90.0000036657751,
      "st": 0,
      "bm": 0,
      "sr": 1 }] }],


  "layers": [{
    "ddd": 0,
    "ind": 0,
    "ty": 0,
    "nm": "dropping-comp",
    "refId": "comp_0",
    "ks": {
      "o": {
        "k": 100 },

      "r": {
        "k": [{
          "i": {
            "x": [0.667],
            "y": [1] },

          "o": {
            "x": [0.85],
            "y": [0.007] },

          "n": ["0p667_1_0p85_0p007"],
          "t": 24,
          "s": [0],
          "e": [200] },
        {
          "i": {
            "x": [0.667],
            "y": [1] },

          "o": {
            "x": [0.333],
            "y": [0] },

          "n": ["0p667_1_0p333_0"],
          "t": 47.953,
          "s": [200],
          "e": [175] },
        {
          "i": {
            "x": [0.667],
            "y": [1] },

          "o": {
            "x": [0.333],
            "y": [0] },

          "n": ["0p667_1_0p333_0"],
          "t": 53.951,
          "s": [175],
          "e": [180] },
        {
          "t": 57.9512523604028 }] },


      "p": {
        "k": [200, 200, 0] },

      "a": {
        "k": [200, 200, 0] },

      "s": {
        "k": [100, 100, 100] } },


    "w": 400,
    "h": 400,
    "ip": 0,
    "op": 94.9050038655599,
    "st": 0,
    "bm": 0,
    "sr": 1 }],

  "v": "4.4.12",
  "ddd": 0,
  "ip": 0,
  "op": 90.0000036657751,
  "fr": 29.9700012207031,
  "w": 400,
  "h": 400 };


class Preloader {
  constructor(container) {
    this.css = {
      progressBarTop: "page-preloader__progress-bar_top",
      progressBarBottom: "page-preloader__progress-bar_bottom",
      rect: "rect",
      text: "page-preloader__text",
      animationContainer: "page-preloader__animation",
      dropLine: "page-preloader__drop-line",
      dropLineAnimated: "page-preloader__drop-line_animated" };

    this.$dispatcher = $({});
    this.$container = container;
    this.$progressBarTop = container.find("." + this.css.progressBarTop);
    this.$progressBarBottom = container.find("." + this.css.progressBarBottom);
    this.$rects = container.find("." + this.css.rect);
    this.$text = container.find("." + this.css.text);
    this.$animationContainer = container.find("." + this.css.animationContainer);
    this.$dropLine = container.find("." + this.css.dropLine);
    this._animationPlayer = null;
    this._currentFrame = 0;
    this._progress = 0;
    this._isFinish = false;
    this._animationData = {
      rectScale: 1,
      rombSkew: 0,
      rombScale: 1 };

    this._onStartComplete = null;
    this._onAnimationComplete = null;
    this._startPromise = null;
    this._lineDropped = false;
    this._progressStarted = false;
    gsap.to(this.$text, 0.5, {
      opacity: 1 });

  }

  start() {
    const t = this;
    return (
      null == this._startPromise && (
      this._startPromise = new Promise(resolve => {
        t._onStartComplete = resolve,
        t._animationPlayer = lottie.loadAnimation({
          container: t.$animationContainer[0],
          renderer: "svg",
          loop: false,
          autoplay: true,
          animationData: preload }),

        t._animationPlayer.addEventListener("enterFrame", function (e) {
          gsap.to(t.$text, 0.5, {
            opacity: 0,
            onComplete: function () {
              t.$text.remove();
            } }),

          t._animationPlayerListener(e);
        }),
        t._animationPlayer.addEventListener("complete", function (e) {
          t._animationPlayerListener(e);
        }),
        gsap.ticker.add(t._onEnterFrameListener);
      })),
      this._startPromise);

  }

  finish() {
    const t = this;
    return new Promise(resolve => {
      t._isFinish = true;
      if (t._lineDropped) {
        t._setProgress(1, .75, resolve);
        gsap.to(t._animationData, {
          duration: .9375,
          rectScale: 0,
          ease: "Power2.easeInOut" });

      } else
      t._onAnimationComplete = resolve;
    });
  }

  // hide() {
  // 	return new Promise((resolve, reject) => {
  // 		gsap.to(this._animationData, 0.35, {
  // 			rombSkew: 35,
  // 			rombScale: 0,
  // 			onComplete: function() {
  // 				resolve();
  // 			}
  // 		});
  // 	});
  // }
  hide() {
    const t = this;
    return gsap.to(t._animationData, {
      duration: .35,
      rombSkew: 35,
      rombScale: 0 }).
    then(),
    // resolve(),
    console.log("hidden");
  }

  destroy() {
    this._animationPlayer.destroy();
    this.$container.remove();
    gsap.ticker.remove(this._onEnterFrameListener);
  }

  _setProgress(preloader, event, callback = null) {
    // const i = null;
    const ease = Power2.easeInOut;

    gsap.to(this, event, {
      _progress: preloader,
      ease: ease,
      onComplete: callback });

  }

  _animationPlayerListener(event) {
    switch (event.type) {
      case "enterFrame":
        if (
        this._currentFrame++,
        this._animationPlayer.currentFrame >= 54 &&
        !this._lineDropped && (
        this.$dropLine.addClass(this.css.dropLineAnimated),
        this._lineDropped = true),
        this._animationPlayer.currentFrame >= 84 && !this._progressStarted)
        {
          if (this._isFinish) {
            this._setProgress(1, 1, null, Power2.easeInOut),
            gsap.to(this._animationData, 1, {
              rectScale: 0,
              ease: Power2.easeInOut }),

            gsap.delayedCall(0.6, () => {
              this._onAnimationComplete && this._onAnimationComplete.apply(null);
            });
          } else
          this._progress = 0.01,
          this._setProgress(0.75 + 0.1 * Math.random(), 10, null, Power2.easeOut);
          this._progressStarted = true;
        }
        break;
      case "complete":
        this._onStartComplete && this._onStartComplete.apply(null);}

  }

  _onEnterFrameListener(event) {
    this.$progressBarTop.css(
    "transform",
    "translate(-50%, -50px) scaleX(" + this._progress + ")");

    this.$progressBarBottom.css(
    "transform",
    "translate(-50%, 50px) scaleX(" + this._progress + ")");

    this.$rects.css("transform", "scaleX(" + this._animationData.rectScale + ")");
    this.$animationContainer.css(
    "transform",
    "translate3d(-50%, -50%, 0) scaleX(" +
    this._animationData.rombScale +
    ") skewY(" + (
    0 | this._animationData.rombSkew) +
    "deg)");

  }}


$(document).ready(() => {
  const preloadr = $(".page-preloader");
  preloadr.length && (window.preloader = new Preloader(preloadr), window.preloader.start()),
  void 0 === document.createElement("p").style.flex && $("html").addClass("no-flex");
});